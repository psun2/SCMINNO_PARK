/*
 * RequestDispatcher rd = request.getRequestDispatcher("이동할 페이지");
rd.forward(request, response);

요렇게 하면 페이지 주소는 바뀌지 않고 내용만 바뀐다.
페이지가 바뀌어도  reqeust는 바뀌지 않으므로
request에 attribute를 설정해서 이동할 페이지로 값을 가져갈 수 있다.

2.redirect
response.sendRedirect("이동할 페이지");
페이지 주소도 바뀌고 request도 바뀌게 되므로  reqeust의 attribute는 사용할 수 없다.
 * */
package file;

import java.io.IOException;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.oreilly.servlet.MultipartRequest;
import com.oreilly.servlet.multipart.DefaultFileRenamePolicy;

@WebServlet("/uploadAction")
public class uploadAction extends HttpServlet {
	private static final long serialVersionUID = 1L;
       
    public uploadAction() {
        super();
        // TODO Auto-generated constructor stub
    }


	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		System.out.println("doGet");
	}


	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		System.out.println("doPost");
		
		String directory = "D:\\\\File_UPandDOWN\\COS and Dynamic Web Project\\workspace\\File Upload\\src\\main\\webapp\\uploadFileForder";
		int maxSize = 1024 * 1024 *100;
		String encoding = "UTF-8";
		
		MultipartRequest multipartRequest = new MultipartRequest(request, directory, maxSize, encoding, new DefaultFileRenamePolicy());
		
		String fileName = multipartRequest.getOriginalFileName("file");
		String fileRealName = multipartRequest.getFilesystemName("file");
		
		System.out.println(fileName);
		System.out.println(fileRealName);
		
		request.setAttribute("fileName", fileName);
		request.setAttribute("fileRealName", fileRealName);
		
		new FileDAO().upload(fileName, fileRealName);
		
		// RequestDispatcher requestDispatcher = request.getRequestDispatcher("/uploadAction2.jsp");
		// requestDispatcher.forward(request, response);
		
		response.sendRedirect("/uploadAction.jsp");
	}

}
